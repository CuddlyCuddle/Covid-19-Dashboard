---
title: "Covid-19"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill

---

```{r setup, include=FALSE}
library(flexdashboard)
library(ggplot2)
library(dplyr)
library(DT)
library(leaflet)
library(rgdal)
library(RColorBrewer)
library(plotly)
library(zoo)
```


```{r, include=FALSE}
data <- read.csv('https://covid.ourworldindata.org/data/owid-covid-data.csv', header = T)

```

```{r, echo = F}
cum_dat <- data %>% 
  filter(as.Date(date) == max(as.Date(date))) %>%
    select(iso_code, Country = location, Cases = total_cases, total_cases_per_million, Deaths = total_deaths, total_deaths_per_million) %>%
  group_by(Country)
```

Global Cases
===================================== 

Row
-------------------------------------
### Global
```{r}
valueBox("Covid-19 Analysis")
```

### Confirmed Cases
```{r}
valueBox(cum_dat$Cases[cum_dat$Country == "World"])
```

### Deaths
```{r}
valueBox(cum_dat$Deaths[cum_dat$Country == "World"])
```

### Mortality Rate
```{r}
valueBox(paste(round(cum_dat$Deaths[cum_dat$Country == "World"]/cum_dat$Cases[cum_dat$Country == "World"]*100, 2), "%", sep = ""))
```

Row {.tabset}
-------------------------------------
### New Daily Infections
```{r}
#Creating a Subsetted Dataframe
world_dat <- data %>% 
  filter(location == "World") %>% 
  mutate(date = as.Date(date),
         new_cases_SMA7 = rollmean(new_cases, k = 7, align = "center", fill = NA))

#Creating Plot
fig <- plot_ly(world_dat, 
               x = ~date, 
               y = ~new_cases, 
               type = "bar",
               name = "New Cases"
               )

#Adding Moving Averages
fig <- fig %>% add_trace(y = ~new_cases_SMA7,
                         name = "7-Day Moving Average", 
                         type = "scatter", 
                         mode = "lines", 
                         line = list(color = 'rgb(250, 162, 0)'))
fig <- fig %>% layout(yaxis = list(title = "New Cases"), 
                      xaxis = list(title = "Date")
  
)
fig
```

### Suseptible-Infected-Deaths
```{r}
fig <- plot_ly(world_dat, x = ~date, y = ~population-total_cases, name = "Suseptible", type = 'scatter', mode = 'lines')
fig <- fig %>% add_trace(y = ~total_cases, name = "Infections", type = 'scatter', mode = 'lines')
fig <- fig %>% add_trace(y = ~total_deaths, name = "Deaths", type = 'scatter', mode = 'lines')
fig <- fig %>% layout(xaxis = list(title = "Date"), yaxis = list(title = "Population"))
fig
```

  
### Important Information
  This model is not an accurate representation of the SIR model because there is insufficient data tracking individuals who have recovered from COVID-19: thus, infections is not an accurate representation of current infectious and wil contain both infected and infectious individuals. Where the model calls for $S$ = the number of susceptible individuals, $I$ = the number of infectious individuals, $R$ = individuals who have recovered or have deceased.
  
  In addition, the removed has been replaced with death due to the same reason regarding the data. For more information on the SIR model read the section named additional information.
  
  Please note that this model does not account for changing populations.



Row
-------------------------------------
### Cases by Country

```{r}
## Plotting Cases accross the world
l <- list(color = toRGB("grey"), width = 0.5)

# specify map projection/options
g <- list(
  showframe = FALSE,
  showcoastlines = FALSE,
  projection = list(type = 'Mercator')
)

fig <- plot_geo(cum_dat)
fig <- fig %>% add_trace(
    z = ~Cases, color = ~Cases, colors = 'Blues',
    text = ~Country, locations = ~iso_code, marker = list(line = l)
  )
fig <- fig %>% colorbar(title = 'Cases')
fig <- fig %>% layout(autosize = T, 
                      # width = 500, 
                      # height = 500,
                       geo = g)

fig

```


### Table of Cumulative Confirmed Cases, Deaths, and Tests
```{r}
datatable(
  data %>% 
  filter(as.Date(date) == max(as.Date(date)), location != "World") %>%
    select(Country = location, 
           Population = population, 
           Cases = total_cases, 
           "Cases Per Million" = total_cases_per_million,
           Deaths = total_deaths, 
           "Deaths Per Million" = total_deaths_per_million) %>%
  mutate("PopulationInfected (%)" = round((Cases/Population)*100, 3),
         "Mortality (%)" = round(Deaths/Cases*100, 3)) %>%
  group_by(Country) %>%
  arrange(desc(Cases))
)
```


Graphics By Country 
===================================== 

Column {.sidebar}
-------------------------------------
```{r}
# Sigmoid/Cum_Country(lin-log) Inputs


# Growth Comparison

```


Column 
-------------------------------------
```{r}
# Plotting Sigmoid/Cum_country(lin-log)
by_days <- data %>% group_by(location) %>% filter(total_cases >= 1) %>%
  mutate(days = as.numeric(-rev(difftime(as.Date(date), max(as.Date(date)), units = "days")))) %>%
  select(location, total_cases, days)

ggplot()

fig <- plotly(by_days, x = ~days, y = ~total_cases, type = "scatter", mode = "lines", transforms = list(list(type = "groupby", groups = ~location)))
```


Timeline
===================================== 

Column {.sidebar}
-------------------------------------
```{r}



```


Column 
-------------------------------------
```{r}




```


Additional Information
=====================================
